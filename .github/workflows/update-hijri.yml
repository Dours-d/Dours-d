name: Update Hijri Date
on:
  schedule:
    - cron: '0 0 * * *'
  workflow_dispatch: 

permissions:
  contents: write

jobs:
  update-readme:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Get Hijri Date and Update README
        shell: python
        run: |
          import urllib.request
          import json
          import re

          # 1. Fetch the date
          try:
              with urllib.request.urlopen("http://api.aladhan.com/v1/gToH") as response:
                  data = json.loads(response.read().decode())
                  hijri = data['data']['hijri']
                  date_str = f"Today's Hijri Date: {hijri['date']} ({hijri['month']['en']} {hijri['year']})"
          except Exception as e:
              print(f"Error fetching date: {e}")
              exit(1)

          # 2. Read the README
          with open("README.md", "r", encoding="utf-8") as f:
              content = f.read()

          # 3. Replace the content between tags
          pattern = r"()(.*?)()"
          replacement = f"\\1\n{date_str}\n\\3"
          new_content = re.sub(pattern, replacement, content, flags=re.DOTALL)

          # 4. Write back to README
          with open("README.md", "w", encoding="utf-8") as f:
              f.write(new_content)

      - name: Commit and Push
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git add README.md
          git diff --quiet && git diff --staged --quiet || (git commit -m "Update Hijri date" && git push)
