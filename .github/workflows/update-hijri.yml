name: Update Hijri Date
on:
  workflow_dispatch: 
  schedule:
    - cron: '0 0 * * *'

permissions:
  contents: write

jobs:
  update-readme:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Rebuild README
        shell: python
        run: |
          import urllib.request
          import json
          import sys

          # 1. Get the Date
          try:
              with urllib.request.urlopen("http://api.aladhan.com/v1/gToH") as response:
                  data = json.loads(response.read().decode())
                  h = data['data']['hijri']
                  # Added the Arabic and English month
                  date_str = f"### ðŸŒ™ {h['day']} {h['month']['en']} {h['year']} | {h['month']['ar']}"
          except Exception as e:
              print(f"API Error: {e}")
              sys.exit(1)

          # 2. Define our markers
          start_tag = "[//]: # (HIJRI_START)"
          end_tag = "[//]: # (HIJRI_END)"

          # 3. Read README
          with open("README.md", "r", encoding="utf-8") as f:
              lines = f.readlines()

          # 4. Filter out any existing lines between the tags
          new_lines = []
          skip = False
          tag_found = False

          for line in lines:
              if start_tag in line:
                  new_lines.append(line)
                  new_lines.append(date_str + "\n")
                  skip = True
                  tag_found = True
              elif end_tag in line:
                  new_lines.append(line)
                  skip = False
              elif not skip:
                  new_lines.append(line)

          if not tag_found:
              print("Tags not found! Make sure they are in your README.")
              sys.exit(1)

          # 5. Write back
          with open("README.md", "w", encoding="utf-8") as f:
              f.writelines(new_lines)

      - name: Push Changes
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git add README.md
          git commit -m "Clean Hijri Update" || exit 0
          git push
